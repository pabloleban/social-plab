<style>
    .mode-monthly .main{
        position: relative;
        width: 1080px;
        height: 1080px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        zoom: 0.5;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
    }

    .mode-monthly .nice-border{
        position: absolute;
        z-index: 110;
        width: 100%;
        pointer-events: none;
    }
    
    .mode-monthly .mask1{
        clip-path: polygon(0 0, 0% 100%, 100% 0);
        position: absolute;
        width: 670px;
        height: 680px;
        top: 0;
        z-index: 10;
        left: 0;
    }

    .mode-normal .pic {
        position: absolute;
    }

    .mode-monthly .mask2{
        position: absolute;
        top: 0;
        left: 0;
    }

    .mode-monthly .mask3{
        clip-path: polygon(100% 0, 0 100%, 100% 100%);
        position: absolute;
        width: 690px;
        height: 700px;
        bottom: 0;
        right: 0;
        z-index: 10;
    }

    .mode-monthly .cover-text{
        line-height: 1.3em;
        text-align: left;
        color: #ffffff;
        height: 148px;
        top: 387px;
        font-size: 60px;
        width: 570px;
        z-index: 116;
        font-weight: 900;
        position: absolute;
        word-break: break-word;
    }

    .mode-monthly .date-text{
        text-align: center;
        color: #ffffff;
        height: 143px;
        top: 720px;
        width: 210px;
        line-height: 162px;
        left: 34px;
        z-index: 116;
        font-weight: 900;
        position: absolute;
    }

    .mode-monthly .name-text{
        color: #ffffff;
        height: 54px;
        line-height: 66px;
        top: 750px;
        width: 330px;
        left: 267px;
        z-index: 116;
        font-weight: 900;
        position: absolute;
    }

    .mode-monthly .platform-text{
        color: #ffffff;
        height: 54px;
        top: 804px;
        width: 250px;
        left: 267px;
        z-index: 116;
        font-weight: 900;
        position: absolute;
    }

    .mode-monthly .cover-sub-text{
        line-height: 1.3em;
        text-align: right;
        color: #ffffff;
        height: 80px;
        top: 610px;
        right: 255px;
        font-size: 60px;
        width: 569px;
        z-index: 116;
        font-weight: 900;
        position: absolute;
        word-break: break-word;
    }

</style>

<div class="col-lg-12 col-xl-6 mb-5">
    <div class="row">
        <div class="col-12 justify-content-center d-flex">
            <div class="main mb-4" id="full-picture">
                <img src="assets/images/monthly.png" class="nice-border">
                <div class="mask1 is-cover">
                    <span>
                        <img class="pic cover-bg" id="bg-1">
                    </span>
                </div>
                <div class="mask2 is-cover">
                    <span>
                        <img class="pic cover-bg" id="bg-2">
                    </span>
                </div>
                <div class="mask3 is-cover">
                    <span>
                        <img class="pic cover-bg" id="bg-3">
                    </span>
                </div>
                <div class="is-not-cover">
                    <span>
                        <img class="pic" id="update-bg">
                    </span> 
                </div>
                <div class="date-text is-not-cover"><span></span></div>
                <div class="name-text is-not-cover"><span></span></div>
                <div class="platform-text is-not-cover"><span></span></div>
                <div class="cover-text is-cover"></div>
                <div class="cover-sub-text is-cover"></div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center" id="button-thumbs">
        <div class="col-3 w-100 text-center my-2" id="cover-thumb"><button class="btn btn-secondary btn-lg">Cover</button></div>
    </div>
</div>
<div class="col-lg-12 col-xl-6">
    <div id="accordion">
        <div class="card bg-dark text-white" id="selected-update-configuration">
            <div class="card-header bg-primary clickable" id="temp" data-toggle="collapse" data-target="#selected-update-config" aria-expanded="true" aria-controls="selected-update-config">
                <h5 class="mb-0">
                    Selected Update Configuration
                </h5>
            </div>
            <div id="selected-update-config" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                    <div class="form-group">
                        <label for="selected-update-size">Size - <span></span></label>
                        <input type="range" min="100" max="200" value="100" class="custom-range" id="selected-update-size">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-danger" id="remove-monthly"><i class="fas fa-trash pr-2"></i>Delete Monthly Update</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="card bg-dark text-white" id="cover-configuration">
            <div class="card-header bg-primary clickable" data-toggle="collapse" data-target="#cover-config" aria-expanded="true" aria-controls="cover-config">
                <h5 class="mb-0">
                    Cover Configuration
                </h5>
            </div>
            <div id="cover-config" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                
                    <div class="form-group">
                        <label for="bg">Cover Main Text</label>
                        <input class="form-control" placeholder="Cover Main Text" id="cover-main-text" value="">
                    </div>
                    <div class="form-group">
                        <label for="text">Cover Sub Text</label>
                        <input class="form-control" placeholder="Cover Sub Text" id="cover-sub-text" value="">
                    </div>
                    <div class="form-group">
                        <label for="fontsize">Cover Background Image 1</label>
                        <input class="form-control img-url" placeholder="Cover Background Image 1" id="cover-bg-1" value="https://htmlcolorcodes.com/assets/images/html-color-codes-color-tutorials-903ea3cb.jpg">
                    </div>
                    <div class="form-group">
                        <label for="fontsize">Cover Background Image 2</label>
                        <input class="form-control img-url" placeholder="Cover Background Image 2" id="cover-bg-2" value="https://ak6.picdn.net/shutterstock/videos/1027713866/thumb/10.jpg">
                    </div>
                    <div class="form-group">
                        <label for="fontsize">Cover Background Image 3</label>
                        <input class="form-control img-url" placeholder="Cover Background Image 3" id="cover-bg-3" value="https://d3ansictanv2wj.cloudfront.net/bot-day-background-700x600-ce7fb2df41cfbf6c827cf229da02882a.jpg">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" id="add-monthly"><i class="fas fa-plus pr-2"></i>Add monthly update</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group mt-4">
        <label for="text">Folder Name</label>
        <input class="form-control" placeholder="Nombre" id="filename" value="quicksave-news.png">
    </div>
    <button class="btn btn-primary" id="download">Download All Files</button>
</div>

<script>

let monthlyData = [];
let objectCounter = 0;
let selectedUpdateID;
$(() => {
    const monthly = $("#mode-monthly")

    const loadImage = (imgId, inputId = undefined) => {
        if(inputId) monthly.find(imgId).attr("src", monthly.find(inputId).val().trim());
        monthly.find(imgId).unbind("load")
        monthly.find(imgId).on("load", function(){
            const height = this.naturalHeight;
            const width = this.width;

            if(height > width){
                monthly.find(imgId).width("100%")
            } else {
                monthly.find(imgId).height("100%")
            }
        })
    }

    monthly.find("#cover-sub-text").val(new Date().getFullYear());
    monthly.find("#cover-main-text").val(`LO MÁS ESPERADO DE ${new Date().toLocaleString("es-es", {month: "long"}).toUpperCase()}`);

    loadImage("#bg-1", "#cover-bg-1");
    loadImage("#bg-2", "#cover-bg-2");
    loadImage("#bg-3", "#cover-bg-3");

    monthly.find("#bg-1, #bg-2, #bg-3").on("input", () => {
        loadImage()
    })

    monthly.find("#cover-config input:not(.img-url)").on("input", () => { openMonthlyUpdate() })
    monthly.find(".cover-bg").each((a, e) =>{
        $(e).parent().draggable()
    })
    const openMonthlyUpdate = (data) => {
        monthly.find(".nice-border").attr("src", !data ? "assets/images/monthly.png" : "assets/images/banner-monthly.png");
        
        if(!data){
            selectedUpdateID = null
            monthly.find(".is-cover").show();
            monthly.find(".is-not-cover").hide();
            monthly.find(".cover-text").text(monthly.find("#cover-main-text").val());
            monthly.find(".cover-sub-text").text(monthly.find("#cover-sub-text").val());
            monthly.find("#selected-update-configuration").hide();
            monthly.find("#cover-configuration").show();
        } else {
            selectedUpdateID = data.id
            monthly.find("#selected-update-configuration").show();
            monthly.find("#cover-configuration").hide();
            monthly.find(".is-cover").hide();
            monthly.find(".is-not-cover").show();
            monthly.find("#update-bg").attr("src", data.background)
            monthly.find(".date-text span").text(data.date)
            monthly.find(".date-text").textfill({maxFontPixels: 99999})
            monthly.find(".name-text span").text(data.name)
            monthly.find(".name-text").textfill({maxFontPixels: 99999})
            monthly.find(".platform-text span").text(data.platform)
            monthly.find(".platform-text").textfill({maxFontPixels: 30})
            monthly.find("#update-bg").parent().css({
                top: data.bgTop+"px",
                left: data.bgLeft+"px"
            })
            monthly.find("#update-bg").css("transform", `scale(${data.imgSize/100})`)
        }
    }

    monthly.find("#add-monthly").click(async () => {
        const result = await Swal.fire({
            title:"New monthly update",
            html:`
            <div class="form-group">
                <input class="form-control" id="bg" placeholder="Background URL">
            </div>
            <div class="form-group">
                <input class="form-control" id="name" placeholder="Game name">
            </div>
            <div class="form-group">
                <input class="form-control" id="date" placeholder="Release date">
            </div>
            <div class="form-group">    
                <input class="form-control" id="platform" placeholder="Platform">
            </div>`,
            showConfirmButton: true,
            showCancelButton: true,
        })

        if(!result.value) return;

        objectCounter++;

        const newGame = {
            id: objectCounter,
            name: $(Swal.getContent()).find("#name").val(),
            date: $(Swal.getContent()).find("#date").val(),
            platform: $(Swal.getContent()).find("#platform").val(),
            background: $(Swal.getContent()).find("#bg").val(),
            bgLeft: 0,
            bgTop: 0,
            imgSize: 100,
        }

        monthlyData.push(newGame)

        monthly.find("#button-thumbs").append(`
            <div class="col-3 w-100 text-center my-2">
                <button class="btn btn-secondary thumb btn-lg" data-id="${objectCounter}">${newGame.name}</button>
            </div>
        `).on('click',`.thumb[data-id=${objectCounter}]`, event => {
            const elemID = $(event.currentTarget).data("id")
            openMonthlyUpdate(monthlyData.find(d => elemID == d.id));
        })

        loadImage("#update-bg")

        openMonthlyUpdate(monthlyData[monthlyData.length-1]);
    })

    monthly.find("#cover-thumb button").click(() => { openMonthlyUpdate() })

    monthly.find("#selected-update-size").on("input", () => {
        const found = monthlyData.find(d => d.id == selectedUpdateID)
        if(!found) return;
        found.imgSize = $("#selected-update-size").val()        
    })

    openMonthlyUpdate();

    monthly.find("#update-bg").parent().draggable({
        stop: (e, ui) => {
            const found = monthlyData.find(d => d.id == selectedUpdateID)
            if(!found) return;
            found.bgTop = ui.position.top
            found.bgLeft = ui.position.left
        }
    });

    monthly.find("#download").click(async () => {
        monthly.find("#cover-thumb button").trigger("click")
        await download(monthly.find('#full-picture'), "Cover.png")

        monthlyData.forEach(async d => {
            monthly.find(`.thumb[data-id='${d.id}']`).trigger("click")
            await download(monthly.find('#full-picture'), d.name+".png")
        })
    })
})

</script>